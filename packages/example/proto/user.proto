syntax = "proto3";

package example;

import "spine/options.proto";

// User message representing a user entity with validation constraints
message User {
  option (required_field) = "id | email";

  // User ID - set once and cannot be changed
  int32 id = 1 [(set_once) = true, (min).value = "1"];

  // User name - required, with pattern validation
  string name = 2 [(required) = true,
                   (pattern).regex = "^[A-Za-z][A-Za-z0-9 ]{1,49}$",
                   (pattern).error_msg = "Name must start with a letter and be 2-50 characters. Provided: `{value}`."];

  // User email - required, with pattern validation for email format
  string email = 3 [(required) = true,
                    (pattern).regex = "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
                    (pattern).error_msg = "Email must be valid. Provided: `{value}`."];

  // User role - required
  Role role = 4 [(required) = true];

  // Tags - distinct values only
  repeated string tags = 5 [(distinct) = true];
}

// Role enumeration
enum Role {
  ROLE_UNSPECIFIED = 0;
  ROLE_USER = 1;
  ROLE_ADMIN = 2;
  ROLE_MODERATOR = 3;
}

// Request message for getting a user
message GetUserRequest {
  // User ID must be positive
  int32 user_id = 1 [(required) = true,
                     (min).value = "1",
                     (if_missing).error_msg = "User ID is required."];
}

// Response message for getting a user
message GetUserResponse {
  // User data with validation enabled
  User user = 1 [(validate) = true,
                 (if_invalid).error_msg = "User data is invalid."];
  bool found = 2;
}
