syntax = "proto3";

package spine.validation.testing.integration;

// Integration test messages demonstrating validation in a product management system.
//
// This file showcases complex validation scenarios including nested message
// validation, field dependencies with `(goes)`, pattern validation, and
// range constraints across multiple message types.

import "google/protobuf/timestamp.proto";
import "spine/options.proto";

// Product message representing a product entity with validation constraints.
message Product {
    // Must follow format 'prod-XXX' (e.g., prod-123).
    string id = 1 [
        (required) = true,
        (set_once) = true,
        (pattern).regex = "^prod-[0-9]+$",
        (pattern).error_msg = "Product ID must follow format 'prod-XXX'. Provided: `{value}`."
    ];
    string name = 2 [
        (required) = true,
        (if_missing).error_msg = "Product name is required."
    ];
    string description = 3;
    double price = 4 [
        (required) = true,
        (min).value = "0.01",
        (min).error_msg = "Price must be at least {other}. Provided: {value}."
    ];
    int32 stock = 5 [
        (min).value = "0",
        (range) = "[0..1000000)"
    ];
    google.protobuf.Timestamp created_at = 6 [(required) = true];
    Category category = 7 [
        (required) = true,
        (validate) = true,
        (if_invalid).error_msg = "Category is invalid."
    ];
    Color text_color = 8 [(goes).with = "highlight_color"];
    Color highlight_color = 9 [(goes).with = "text_color"];
}

// Color message for display settings.
message Color {
    int32 red = 1 [(range) = "[0..255]"];
    int32 green = 2 [(range) = "[0..255]"];
    int32 blue = 3 [(range) = "[0..255]"];
}

// Category message with validation.
message Category {
    int32 id = 1 [
        (required) = true,
        (min).value = "1"
    ];
    string name = 2 [(required) = true];
}

// Payment method demonstrating is_required oneof option.
message PaymentMethod {
    oneof method {
        option (is_required) = true;

        PaymentCardNumber payment_card = 1 [(validate) = true];
        BankAccount bank_account = 2 [(validate) = true];
    }
}

// Payment card number with validation.
message PaymentCardNumber {
    // Must be 13-19 digits.
    string number = 1 [
        (required) = true,
        (pattern).regex = "^[0-9]{13,19}$",
        (pattern).error_msg = "Card number must be 13-19 digits."
    ];
    int32 expiry_month = 2 [
        (required) = true,
        (range) = "[1..12]"
    ];
    int32 expiry_year = 3 [
        (required) = true,
        (min).value = "2024"
    ];
}

// Bank account with validation.
message BankAccount {
    // Must be 8-17 digits.
    string account_number = 1 [
        (required) = true,
        (pattern).regex = "^[0-9]{8,17}$"
    ];
    // Must be exactly 9 digits (US routing number format).
    string routing_number = 2 [
        (required) = true,
        (pattern).regex = "^[0-9]{9}$"
    ];
}

// Request message for listing products with pagination.
message ListProductsRequest {
    int32 page = 1 [
        (required) = true,
        (min).value = "1",
        (if_missing).error_msg = "Page number is required."
    ];
    int32 page_size = 2 [
        (required) = true,
        (range) = "[1..100]",
        (if_missing).error_msg = "Page size is required."
    ];
    string search_query = 3;
}

// Response message for listing products.
message ListProductsResponse {
    repeated Product products = 1 [(validate) = true];
    int32 total_count = 2 [(min).value = "0"];
}
